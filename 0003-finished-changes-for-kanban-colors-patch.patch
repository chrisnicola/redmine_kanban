From 4880c6974bad301e2c0dd405b1d4860f9f07705f Mon Sep 17 00:00:00 2001
From: chris <chris@i0-linux.localdomain>
Date: Mon, 12 Oct 2009 12:23:55 -0700
Subject: [PATCH] finished changes for kanban colors patch

---
 app/helpers/kanbans_helper.rb                |   15 +++++++++++++++
 app/views/kanbans/_issue.html.erb            |    2 +-
 app/views/settings/_kanban_settings.html.erb |   10 +++++-----
 3 files changed, 21 insertions(+), 6 deletions(-)

diff --git a/app/helpers/kanbans_helper.rb b/app/helpers/kanbans_helper.rb
index 8008164..ec4614f 100644
--- a/app/helpers/kanbans_helper.rb
+++ b/app/helpers/kanbans_helper.rb
@@ -41,4 +41,19 @@ module KanbansHelper
     end
     css
   end
+  def tracker_to_color(trackerid)
+    color = "background-color: "
+    if trackerid == @settings['category']['feature']['tracker'].to_i
+      color += @settings['category']['feature']['color'].to_s
+    elsif trackerid == @settings['category']['defect']['tracker'].to_i
+      color += @settings['category']['defect']['color'].to_s
+    elsif trackerid == @settings['category']['architecture']['tracker'].to_i
+      color += @settings['category']['architecture']['color'].to_s
+    elsif trackerid == @settings['category']['technicaldebt']['tracker'].to_i
+      color += @settings['category']['technicaldebt']['color'].to_s
+    else
+      color = ""
+    end
+    color
+  end
 end
diff --git a/app/views/kanbans/_issue.html.erb b/app/views/kanbans/_issue.html.erb
index 166f5e3..b055263 100644
--- a/app/views/kanbans/_issue.html.erb
+++ b/app/views/kanbans/_issue.html.erb
@@ -1,6 +1,6 @@
 <% if issue %>
 <li id="issue_<%= issue.id %>" class="<%= over_pane_limit?(limit, issue_counter) if defined?(limit) -%> <%= kanban_issue_css_classes(issue) %>">
-  <div class="issue-details">
+  <div class="issue-details" style="color:black;padding:4px;<%= tracker_to_color(issue.tracker.id) %>" >
     <%= link_to(image_tag('ticket.png'), :controller => 'issues', :action => 'show', :id => issue) %>
     #<%= h(issue.id) %> - <%= h(issue.project.name) %> - <%= h(issue.subject) %>
   </div>
diff --git a/app/views/settings/_kanban_settings.html.erb b/app/views/settings/_kanban_settings.html.erb
index aab0861..37303fc 100644
--- a/app/views/settings/_kanban_settings.html.erb
+++ b/app/views/settings/_kanban_settings.html.erb
@@ -19,17 +19,17 @@ def issue_status_pane(pane_name)
 end
    def tracker_color(category_name)
     selected_tracker = @settings['category'][category_name] && @settings['category'][category_name]['tracker'] ? @settings['category'][category_name]['tracker'].to_i : ''
-    color = @settings['category'][category_name] && @settings['category'][category_name]['color'] ? @settings['category'][category_name]['color'].to_i : ''
+    color = @settings['category'][category_name] && @settings['category'][category_name]['color'] ? @settings['category'][category_name]['color'].to_s : ''
     tracker = content_tag(:p,
       content_tag(:label, l("kanban_label_#{category_name}".to_sym)) +
-      select_tag("settings[category][#{category_name}][category]",
+      select_tag("settings[category][#{category_name}][tracker]",
                  content_tag(:option, '') +
                  options_from_collection_for_select(Tracker.all,
                                                     :id,
                                                     :name,
                                                     selected_tracker)) +
 
-      content_tag(:span, l(:kanban_label_limit), :style => "padding: 0 0.5em 0 3em;") +
+      content_tag(:span, l(:kanban_label_color), :style => "padding: 0 0.5em 0 3em;") +
       text_field_tag("settings[category][#{category_name}][color]", color ))
       return tracker
 end
@@ -89,8 +89,8 @@ end
     <%= content_tag(:span, l(:kanban_label_day_limit), :style => "padding: 0 0.5em 0 3em;") %>
     <%= text_field_tag("settings[panes][finished][limit]", finished_limit ) %>
   </p>
-    <%= tracker_color('features') %>
-    <%= tracker_color('defects') %>
+    <%= tracker_color('feature') %>
+    <%= tracker_color('defect') %>
     <%= tracker_color('architecture') %>
     <%= tracker_color('technicaldebt') %>
 </fieldset>
-- 
1.6.0.4

